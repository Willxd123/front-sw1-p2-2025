<div class="flex h-screen w-full">
  <!-- Columna izquierda: agregar widgets + JSON -->
  <aside class="w-1/5 bg-gray-100 p-4 border-r border-gray-300 flex flex-col">

    <!-- BotÃ³n Agregar Container -->
    <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 mb-2" (click)="addContainer()">
      âž• Agregar Container
    </button>
    <button class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 mb-4"
      (click)="isModalFlutterCodeOpen = true">
      ðŸ“„ Ver cÃ³digo Flutter
    </button>

    <!-- Selector de pantallas -->
    <div class="mb-4">
      <label class="block text-sm font-semibold mb-2">Pantallas</label>
      <div class="flex flex-wrap gap-2 mb-2">
        <button *ngFor="let pantalla of pantallas; let i = index" (click)="changePantalla(i)"
          class="px-2 py-1 rounded border text-sm" [ngClass]="{
                  'bg-blue-600 text-white': currentPantalla === i,
                  'bg-white text-gray-800': currentPantalla !== i
                }">
          {{ pantalla.name }}
        </button>
      </div>
      <button class="w-full bg-green-600 text-white py-1 rounded hover:bg-green-700" (click)="addPantalla()">
        âž• Nueva Pantalla
      </button>
    </div>

    <!-- JSON del canvas -->
    <h3 class="text-sm font-semibold mb-2">JSON Canvas</h3>
    <pre class="flex-1 text-xs bg-white p-2 rounded overflow-auto whitespace-pre-wrap">
      <pre class="flex-1 text-xs bg-white p-2 rounded overflow-auto whitespace-pre-wrap">
        {{ getPantallaSinTopLeft() | json }}
      </pre>

    </pre>
  </aside>

  <!-- Canvas central: simulaciÃ³n de pantalla mÃ³vil -->
  <main class="w-3/5 flex justify-center items-center bg-white pt-16">
    <div #canvas class="relative mt-44 bg-gray-100 border border-black shadow-lg origin-top scale-[0.75]"
      [ngStyle]="{ width: '360px', height: '812px' }" (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp($event)">
      <!-- Renderizado de componentes en el canvas -->
      <ng-container *ngFor="let comp of pantallas[currentPantalla].components">
        <div class="absolute cursor-move" [ngClass]="{
    'ring-2 ring-blue-600': selectedComponent?.id === comp.id
  }" [ngStyle]="getComponentStyle(comp)" (click)="selectedComponent = comp" (mousedown)="onMouseDown($event, comp)">
          <div class="w-full h-full flex items-center justify-center text-xs text-gray-800">
            {{ comp.type }}
          </div>
        </div>

      </ng-container>


    </div>
  </main>

  <!-- Columna derecha: panel de configuraciÃ³n -->
  <aside class="w-1/5 bg-gray-100 p-4 border-l border-gray-300 overflow-auto">
    <div *ngIf="selectedComponent" class="space-y-4">
      <h2 class="text-lg font-bold">Propiedades del Container</h2>

      <!-- Color -->
      <div>
        <label class="block text-sm font-semibold">Color</label>
        <input type="color" [value]="selectedComponent.decoration.color"
          (input)="updateProperty('decoration.color', getInputValue($event))" class="w-full h-8 p-0 border" />
      </div>

      <!-- Ancho -->
      <div>
        <label class="block text-sm font-semibold">Ancho (px)</label>
        <input type="number" [value]="selectedComponent.width"
          (input)="updateProperty('width', getInputNumberValue($event))" class="w-full border p-1" />
      </div>

      <!-- Alto -->
      <div>
        <label class="block text-sm font-semibold">Alto (px)</label>
        <input type="number" [value]="selectedComponent.height"
          (input)="updateProperty('height', getInputNumberValue($event))" class="w-full border p-1" />
      </div>

      <!-- Top -->
      <div>
        <label class="block text-sm font-semibold">Top (px)</label>
        <input type="number" [value]="selectedComponent.top"
          (input)="updateProperty('top', getInputNumberValue($event))" [disabled]="selectedComponent.alignment"
          class="w-full border p-1" />
      </div>

      <!-- Left -->
      <div>
        <label class="block text-sm font-semibold">Left (px)</label>
        <input type="number" [value]="selectedComponent.left"
          (input)="updateProperty('left', getInputNumberValue($event))" [disabled]="selectedComponent.alignment"
          class="w-full border p-1" />
      </div>

      <!-- Color del borde -->
      <div>
        <label class="block text-sm font-semibold">Color del borde</label>
        <input type="color" [value]="selectedComponent.decoration.border.color"
          (input)="updateProperty('decoration.border.color', getInputValue($event))" class="w-full h-8 p-0 border" />
      </div>

      <!-- Grosor del borde -->
      <div>
        <label class="block text-sm font-semibold">Grosor del borde (px)</label>
        <input type="number" [value]="selectedComponent.decoration.border.width"
          (input)="updateProperty('decoration.border.width', getInputNumberValue($event))" class="w-full border p-1" />
      </div>

      <!-- Radio de borde -->
      <div>
        <label class="block text-sm font-semibold">Radio de borde (px)</label>
        <input type="number" [value]="selectedComponent.decoration.borderRadius"
          (input)="updateProperty('decoration.borderRadius', getInputNumberValue($event))" class="w-full border p-1" />
      </div>
      <!-- AlineaciÃ³n -->
      <div>
        <label class="block text-sm font-semibold">AlineaciÃ³n</label>
        <select class="w-full border p-1" [value]="selectedComponent.alignment || ''"
          (change)="updateProperty('alignment', getInputValue($event))">
          <option value="">-- Sin alineaciÃ³n (usar top/left) --</option>
          <option value="topLeft">Arriba izquierda</option>
          <option value="topCenter">Arriba centro</option>
          <option value="topRight">Arriba derecha</option>
          <option value="centerLeft">Centro izquierda</option>
          <option value="center">Centro</option>
          <option value="centerRight">Centro derecha</option>
          <option value="bottomLeft">Abajo izquierda</option>
          <option value="bottomCenter">Abajo centro</option>
          <option value="bottomRight">Abajo derecha</option>
        </select>
      </div>

    </div>
  </aside>
  
</div>

<div *ngIf="isModalFlutterCodeOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white w-[90%] max-w-4xl max-h-[90%] overflow-auto rounded-lg shadow-lg p-4 relative">
    <button
      class="absolute top-2 right-2 text-gray-700 hover:text-black text-xl"
      (click)="isModalFlutterCodeOpen = false">&times;</button>
    <h2 class="text-lg font-bold mb-2">CÃ³digo Flutter generado</h2>
    <pre class="text-xs bg-gray-100 p-2 rounded whitespace-pre-wrap">
{{ generateFlutterCode() }}
    </pre>
  </div>
</div>
